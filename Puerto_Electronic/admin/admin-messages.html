<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mensajes de Contacto - Admin</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <main class="admin-page">
        <div class="admin-container">
            <aside class="admin-sidebar">
                <h2 class="admin-title">Panel de Administración</h2>
                <nav class="admin-nav">
                    <ul>
                        <li><a href="admin-home.html"><i class="fas fa-home"></i> Inicio</a></li>
                        <li><a href="admin-products.html"><i class="fas fa-box-open"></i> Productos</a></li>
                        <li><a href="admin-users.html"><i class="fas fa-users"></i> Usuarios</a></li>
                        <li><a href="admin-messages.html" class="active"><i class="fas fa-envelope"></i> Mensajes</a></li>
                        <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
                    </ul>
                </nav>
            </aside>

            <section class="admin-content">
                <div class="header-with-button">
                    <h3>Mensajes de Contacto</h3>
                    <button class="btn delete-all-btn" id="clear-messages-btn">Borrar todos los mensajes</button>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Nombre</th>
                                <th>Correo</th>
                                <th>Mensaje</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="messages-table-body">
                            </tbody>
                    </table>
                </div>
            </section>
        </div>
        </div> <div class="modal-overlay" id="delete-confirm-modal">
            <div class="modal-content">
                <h4>Confirmar Eliminación</h4>
                <p id="modal-text">¿Estás seguro de que deseas eliminar este mensaje?</p>
                <div class="modal-buttons">
                    <button class="btn secondary-btn" id="cancel-delete-btn">Cancelar</button>
                    <button class="btn btn-danger" id="confirm-delete-btn">Sí, Eliminar</button>
                </div>
            </div>
        </div>
        
    </main>

    <script src="../js/scripts.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SELECTORES DEL DOM ---
        const messagesTableBody = document.getElementById('messages-table-body');
        const clearMessagesBtn = document.getElementById('clear-messages-btn');
        const deleteModal = document.getElementById('delete-confirm-modal');
        const modalText = document.getElementById('modal-text');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        let itemToDelete = null; // Guardará el índice del mensaje o 'all'

        // --- FUNCIÓN GLOBAL DE NOTIFICACIÓN ---
        // (Esta función debe existir en tu scripts.js para que funcione)
        const showNotification = (message, type = 'success') => {
            const existing = document.querySelector('.notification-message');
            if(existing) existing.remove();
            const notification = document.createElement('div');
            notification.className = `notification-message ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        };

        // --- LÓGICA DE LA VENTANA MODAL ---
        const openModal = (text, index) => {
            modalText.textContent = text;
            itemToDelete = index;
            deleteModal.classList.add('visible');
        };

        const closeModal = () => {
            deleteModal.classList.remove('visible');
            itemToDelete = null;
        };

        cancelDeleteBtn.addEventListener('click', closeModal);

        confirmDeleteBtn.addEventListener('click', () => {
            if (itemToDelete === 'all') {
                // Borrar todos los mensajes
                localStorage.removeItem('messages');
                showNotification('Todos los mensajes han sido eliminados.');
            } else if (itemToDelete !== null) {
                // Borrar un mensaje individual
                let messages = JSON.parse(localStorage.getItem('messages')) || [];
                messages.splice(itemToDelete, 1);
                localStorage.setItem('messages', JSON.stringify(messages));
                showNotification('Mensaje eliminado con éxito.');
            }
            renderMessages();
            closeModal();
        });

        // --- LÓGICA PARA RENDERIZAR Y MANEJAR MENSAJES ---
        const renderMessages = () => {
            const messages = JSON.parse(localStorage.getItem('messages')) || [];
            messagesTableBody.innerHTML = '';

            if (messages.length === 0) {
                messagesTableBody.innerHTML = '<tr><td colspan="5">No hay mensajes recibidos.</td></tr>';
                clearMessagesBtn.style.display = 'none';
            } else {
                clearMessagesBtn.style.display = 'block';
                messages.forEach((message, index) => {
                    const date = new Date(message.timestamp).toLocaleString();
                    messagesTableBody.innerHTML += `
                        <tr>
                            <td>${date}</td>
                            <td>${message.nombre}</td>
                            <td>${message.email}</td>
                            <td>${message.comentario}</td>
                            <td>
                                <button class="btn delete-message-btn" data-index="${index}">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
            }
        };

        // Event listener para el botón "Borrar todos los mensajes"
        clearMessagesBtn.addEventListener('click', () => {
            openModal('¿Estás seguro de que deseas borrar TODOS los mensajes? Esta acción no se puede deshacer.', 'all');
        });

        // Event listener para los botones "Eliminar" individuales
        messagesTableBody.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-message-btn')) {
                const messageIndex = parseInt(event.target.dataset.index);
                openModal('¿Estás seguro de que deseas eliminar este mensaje?', messageIndex);
            }
        });
        
        // Carga inicial de los mensajes
        renderMessages();
    });
    </script>
</body>
</html>
